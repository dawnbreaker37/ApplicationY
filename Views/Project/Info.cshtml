@model Project
@{
    ViewData["Title"] = "Project Info";

    User? UserInfo = ViewBag.UserInfo;
    Project? ProjectInfo = ViewBag.ProjectInfo;
    GetCommentaries_ViewModel? LastSentComment = ViewBag.LastSentCommentInfo;
    double PrevPricePercentageChange = ViewBag.TargetPriceChangePerc;
    bool IsLiked = ViewBag.IsLiked;
    int CommentsCount = ViewBag.CommentsCount;
}

<div class="main-sidebar p-2 shadow-sm" id="Main_SideBar">
    @if (UserInfo != null)
    {
        <div class="d-none">
            <input type="hidden" id="PageInfo_UserId" value="@UserInfo.Id" />
            <input type="hidden" id="ProjectCreator_Email" value="@ProjectInfo.User?.Email" />
            <form method="get" asp-controller="Notifications" asp-action="GetNotifications" id="GetNotifications_Form">
                <input type="hidden" name="Id" value="@UserInfo.Id" />
            </form>
            <form method="get" asp-controller="Messages" asp-action="GetAll" id="GetAllMessages_Form">
                <input type="hidden" name="Id" value="@UserInfo.Id" />
            </form>
            <form method="get" asp-controller="Messages" asp-action="GetAllSent" id="GetAllSentMessages_Form">
                <input type="hidden" name="Id" value="@UserInfo.Id" />
            </form>
            <form method="get" asp-controller="Messages" asp-action="GetAllReplies" id="GetAllReplies_Form">
                <input type="hidden" name="Id" id="GAR_Id_Val" value="0" />
            </form>
        </div>

        <div class="smallside-box-container p-3 shadow-standard scrollbar-hidden" id="ReplyToComment_Container">
            <button type="button" class="btn btn-back btn-sm float-end ms-1">&larr; Back</button>
            <h5 class="h5 text-truncate">Reply to <span class="text-primary" id="RTC_User"></span></h5>
            <div class="mt-4">
                <div class="box-container bg-light p-3">
                    <input type="hidden" id="RTC_Count" value="0" />
                    <h6 class="h6" id="RTC_Username">Username</h6>
                    <small class="card-text text-muted white-space-on" id="RTC_TextValue">Replying message text</small>
                </div>
                <div class="mt-2 mb-5" id="RepliesList_Box">
                </div>
            </div>
        </div>
    }
    <div class="box-container shadow-sm p-3 text-center">
        <div class="row">
            <div class="col">
                <button type="button" class="btn btn-navbar btn-sm w-100 btn-open-container" id="Preload_Container-OpenX"> <i class="fas fa-file-invoice-dollar"></i> <br />About</button>
            </div>
            <div class="col">
                <form method="get" asp-controller="User" asp-action="GetUserInfo" id="GetUserInfo_Form">
                    <input type="hidden" name="Id" value="@ProjectInfo.UserId" />
                    <button type="submit" class="btn btn-navbar btn-sm w-100"> <i class="fas fa-user-circle"></i> <br/>About @ProjectInfo.User?.PseudoName</button>
                </form>
            </div>
            <div class="col d-lg-none d-md-none d-xl-none d-sm-block">
                <button type="button" class="btn btn-navbar btn-sm w-100 btn-open-container" id="Preload_Container-OpenY"> <i class="fas fa-times text-danger"></i> <br/>Close </button>
            </div>
        </div>
    </div>

    <div class="box-container mt-2 p-3 bg-light">
        <h6 class="h6 safe-font"> <i class="far fa-comments"></i> Comments, <span id="CommentsCountMain_Span">@CommentsCount.ToString("N0")</span></h6>
        @if(LastSentComment == null)
        {
            <small class="card-text text-muted">No recently sent comments</small>
        }
        else
        {
            <div class="mt-2">
                <small class="card-text fw-500">@LastSentComment.SenderName</small>
                <div></div>
                <small class="card-text text-muted white-space-on">@LastSentComment.Text</small>
            </div>
        }
    </div>

    <div class="smallside-box-container p-3 shadow-standard scrollbar-hidden" id="Comments_Container">
        <button type="button" class="btn btn-close float-end ms-1" id="Comments_Container-Close" aria-label="close"></button>
        <h5 class="h5 text-truncate">Comments, <span id="CommentsCount_Span">@CommentsCount.ToString("N0")</span></h5>
        <div class="d-none">
            <input type="hidden" id="CommentsCount_Val" value="@CommentsCount" />
        </div>
        <div class="mt-3 mb-5" id="CommentsMain_Box">

        </div>
    </div>

    @if (UserInfo != null)
    {
        <div class="smallside-box-container p-3 shadow-standard scrollbar-hidden" id="SendMessage_Container">
            <button type="button" class="btn btn-close float-end ms-1" id="SendMessage_Container-Close" aria-label="close"></button>
            <h5 class="h5 text-truncate">Send Message</h5>
            <div class="mt-4">
                <form method="post" asp-controller="Messages" asp-action="Send" id="SendMessage_Form">
                    <div class="d-none">
                        <input type="hidden" name="SenderId" value="@UserInfo.Id" />
                        <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                        <input type="hidden" name="UserId" value="@ProjectInfo.UserId" />
                    </div>
                    <div class="row">
                        <div class="col col-1">
                            <button type="submit" class="btn btn-sm mt-1 rounded-message-btn" id="MsgSendSbmt_Btn" disabled> <i class="fas fa-arrow-up"></i></button>
                        </div>
                        <div class="col col-8">
                            <textarea name="Text" id="Text" rows="1" placeholder="Enter text here" class="form-control w-100 form-control-sm send-msg-form-control"></textarea>
                        </div>
                        <div class="col col-1">
                            <div class="dropstart">
                                <button type="button" class="btn btn-sm mt-1 rounded-message-btn" data-bs-toggle="dropdown" aria-expanded="false"> <i class="fas fa-ellipsis-h"></i> </button>
                                <ul class="dropdown-menu shadow-sm p-1">
                                    <li><button type="button" class="dropdown-item mb-1" id="GetMailOfCreator_Btn"> <i class="fas fa-envelope-open-text"></i> Write Via Mail</button></li>
                                    <li><button type="button" class="dropdown-item select-to-other-links"> <i class="fas fa-paperclip"></i> Other Links of <span class="fw-500">@ProjectInfo.User?.PseudoName</span></button></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col col-2">
                            <button type="button" class="btn btn-sm mt-1 rounded-message-btn w-100 text-full-delete" id="FullDelete-Text"> <i class="fas fa-backspace"></i> </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>

        <div class="mt-3 box-container card-box-container shadow-standard position-absolute p-2" id="ReplyToComment_Container-CardBox">
            <form method="post" asp-controller="Messages" asp-action="SendReply" id="SendReply_Form">
                <input type="hidden" name="CommentId" id="RTC_CommentId_Val" value="0" />
                <input type="hidden" name="UserId" value="@UserInfo.Id" />
                <div class="row">
                    <div class="col col-10">
                        <textarea class="form-control w-100 form-control-sm send-msg-form-control" rows="1" name="Text" id="RTCC_TextValue" placeholder="Enter your answer here" maxlength="2500"></textarea>
                    </div>
                    <div class="col col-2">
                        <button type="submit" class="btn btn-primary rounded-message-btn btn-standard-with-no-colour btn-sm w-100 mt-1" id="RTCSbmt_Btn"> <i class="fas fa-arrow-up"></i> </button>
                    </div>
                </div>
            </form>
        </div>
    }

    <div class="box-container card-box-container shadow-standard position-absolute p-2" id="Comments_Container-CardBox">
        @if (UserInfo != null)
        {
            <div>
                <form method="post" asp-controller="Messages" asp-action="SendComment" id="SendComment_Form">
                    <input type="hidden" name="UserId" value="@UserInfo.Id" />
                    <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                    <div class="row">
                        <div class="col col-10">
                            <textarea class="form-control w-100 form-control-sm send-msg-form-control" rows="1" name="Text" id="SendComment_Text" placeholder="Enter your comment here" maxlength="1500"></textarea>
                        </div>
                        <div class="col col-2">
                            <button type="submit" class="btn btn-primary rounded-message-btn btn-standard-with-no-colour btn-sm w-100 mt-1" id="SendCommentSbmt_Btn"> <i class="fas fa-arrow-up"></i> </button>
                        </div>
                    </div>
                </form>
            </div>
        }
        else
        {
            <div>
                <textarea class="form-control w-100 form-control-sm send-msg-form-control" rows="1" id="SendComment_Text" placeholder="Enter or sign in to send comment" disabled></textarea>
                <a asp-controller="Account" asp-action="Create" class="btn btn-danger btn-standard-with-no-colour btn-sm" disabled> <i class="fas fa-times"></i> </a>
            </div>
        }
    </div>
</div>

<div class="main-container p-3 shadow-standard scrollbar-hidden" id="Preload_Container">
    <div>
        <button type="button" class="btn btn-close float-end" aria-label="close" id="Preload_Container-Close"></button>
        <a asp-controller="Project" asp-action="Report" asp-route-Id="@ProjectInfo.Id" class="btn btn-standard-not-animated btn-sm float-end me-2"> <i class="far fa-flag text-danger"></i> Report</a>
        <a asp-controller="User" asp-action="Purge" asp-route-Id="@ProjectInfo.UserId" class="btn btn-standard-not-animated btn-sm float-end me-2"> <i class="fas fa-bolt text-info"></i> Purge</a>
        <h6 class="h5 text-truncate">Project</h6>
    </div>
    <div class="mt-4">
        <div class="box-container">
            <h1 class="h1 text-primary safe-font" id="Preview_Title">@ProjectInfo.Name</h1>
        </div>
        <div class="box-container shadow-sm mt-2 p-2">
            <div class="p-2">
                @if (UserInfo != null)
                {
                    <button type="button" class="btn btn-light btn-standard-with-no-colour btn-sm float-end ms-1"> <i class="far fa-bell"></i> Subscribe</button>
                    <button type="button" class="btn btn-light btn-standard-with-no-colour btn-sm float-end ms-1 me-1 smallside-btn-open-container" id="SendMessage_Container-Open"> <i class="far fa-paper-plane"></i> Send Message</button>
                }
                else
                {
                    <button type="button" class="btn btn-light btn-standard-with-no-colour btn-sm float-end text-danger ms-1" disabled> <i class="far fa-bell"></i> Sign In</button>
                    <button type="button" class="btn btn-light text-danger btn-standard-with-no-colour btn-sm float-end ms-1 me-1" disabled> <i class="far fa-paper-plane"></i> Sign In</button>
                }
                <h5 class="h5 safe-font">@ProjectInfo.User?.PseudoName</h5>
            </div>
            <div class="row mt-1">
                <div class="col">
                    @if (UserInfo != null)
                    {
                        @if (!IsLiked)
                        {
                            <div id="NotLiked_Box">
                                <form method="post" asp-controller="Project" asp-action="Like" id="LikeTheProject_Form">
                                    <input type="hidden" name="UserId" value="@UserInfo.Id" />
                                    <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                                    <button type="submit" class="btn btn-text btn-standard-with-no-colour w-100" id="LikeSbmt_Btn"> <i class="far fa-heart"></i> <br/>Like</button>
                                </form>
                            </div>
                            <div class="d-none" id="AlreadyLiked_Box">
                                <form method="post" asp-controller="Project" asp-action="RemoveFromLiked" id="RemoveFromLiked_Form">
                                    <input type="hidden" name="UserId" value="@UserInfo.Id" />
                                    <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                                    <button type="submit" class="btn btn-text btn-standard-with-no-colour w-100" id="RemoveLikeSbmt_Btn"> <i class="far fa-grin-hearts text-primary"></i> <br />Liked</button>
                                </form>
                            </div>
                        }
                        else
                        {
                            <div class="d-none" id="NotLiked_Box">
                                <form method="post" asp-controller="Project" asp-action="Like" id="LikeTheProject_Form">
                                    <input type="hidden" name="UserId" value="@UserInfo.Id" />
                                    <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                                    <button type="submit" class="btn btn-text btn-standard-with-no-colour w-100" id="LikeSbmt_Btn"> <i class="far fa-heart"></i> <br />Like</button>
                                </form>
                            </div>
                            <div id="AlreadyLiked_Box">
                                <form method="post" asp-controller="Project" asp-action="RemoveFromLiked" id="RemoveFromLiked_Form">
                                    <input type="hidden" name="UserId" value="@UserInfo.Id" />
                                    <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                                    <button type="submit" class="btn btn-text btn-standard-with-no-colour w-100" id="RemoveLikeSbmt_Btn"> <i class="fas fa-heart text-primary"></i> <br />Liked</button>
                                </form>
                            </div>
                        }
                    }
                    else
                    {
                        <button type="button" class="btn btn-text btn-standard-with-no-colour w-100" disabled> <i class="far fa-heart"></i> <br /> Like</button>
                    }
                </div>
                <div class="col">
                    <div>
                        <form method="get" asp-controller="Messages" asp-action="GetComments" id="GetComments_Form">
                            <input type="hidden" name="ProjectId" value="@ProjectInfo.Id" />
                            <button type="submit" class="btn btn-text btn-standard-with-no-colour w-100"> <i class="far fa-comments"></i> <br /> Comments</button>
                        </form>
                    </div>
                </div>
                <div class="col">
                    <button type="button" class="btn btn-text btn-standard-with-no-colour w-100" data-bs-toggle="collapse" data-bs-target="#MoreInfo_Collapse" aria-expanded="false" aria-controls="MoreInfo_Collapse"> <i class="fas fa-ellipsis-h"></i> <br /> More</button>
                </div>
            </div>
        </div>
        <div class="collapse mt-2" id="MoreInfo_Collapse">
            <div class="card box-container shadow-sm p-3 pb-2">
                <h5 class="h5">Additional Info</h5>
                <div class="row mt-2 border-top pt-3 ms-1 me-1 text-center">
                    <div class="col">
                        <h6 class="h6">Views</h6>
                        <small class="card-text text-muted safe-font" id="Preview_ViewsCnt">@ProjectInfo.Views.ToString("N0")</small>
                    </div>
                    <div class="col">
                        <h6 class="h6">Likes</h6>
                        <small class="card-text text-muted safe-font" id="Preview_LikesCnt">@ViewBag.LikesCount.ToString("N0")</small>
                    </div>
                    <div class="col">
                        <h6 class="h6">Category</h6>
                        <small class="card-text text-muted safe-font" id="Preview_Category">Unknown</small>
                    </div>
                </div>
                <div class="row mt-4 text-center">
                    <div class="col">
                        <h6 class="h6">Published</h6>
                        <small class="card-text text-muted safe-font" id="Preview_PublishedDate">@ProjectInfo.CreatedAt.ToShortDateString()</small>
                    </div>
                    <div class="col">
                        <h6 class="h6">Last Update</h6>
                        <small class="card-text text-muted safe-font" id="Preview_LastUpdatedDate">@ProjectInfo.LastUpdatedAt.ToShortDateString(), at @ProjectInfo.LastUpdatedAt.ToShortTimeString()</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="box-container p-1 pt-2 pb-2 mt-2">
            <p class="card-text white-space-on" id="Preview_ShortDescription">@ProjectInfo.Description</p>
            <p class="card-text white-space-on mt-1" id="Preview_LongDescription">@ViewBag.FullText</p>
        </div>
        <div class="card-group mt-2">
            <div class="card shadow-sm p-3 me-1" id="Preview_StartUpBox">
                @if (ProjectInfo.TargetPrice != 0)
                {
                    <h3 class="h3 text-primary safe-font" id="Preview_TagPrice">$@ProjectInfo.TargetPrice.ToString("N0")</h3>
                    @if(ProjectInfo.PastTargetPrice != 0)
                    {
                        if(PrevPricePercentageChange > 0)
                        {
                            <p class="card-text text-success safe-font"><span class="text-decoration-line-through">$@ProjectInfo.PastTargetPrice.ToString("N0")</span>, +@PrevPricePercentageChange.ToString("N0")%</p>
                            @if (ProjectInfo.PriceChangeAnnotation != null)
                            {
                                <small class="card-text text-muted white-space-on"> <i class="fas fa-quote-right text-primary"></i> @ProjectInfo.PriceChangeAnnotation</small>
                                <div class="border-top mt-2 pt-1"></div>
                            }
                        }
                        else
                        {
                            <p class="card-text text-danger safe-font"><span class="text-decoration-line-through">$@ProjectInfo.PastTargetPrice.ToString("N0")</span>, @PrevPricePercentageChange.ToString("N0")%</p>
                        }
                    }
                    <small class="card-text text-muted" id="Preview_TagPriceDescription">needs this project for his start</small>
                    <div class="mt-3" id="InverToProject_Box">
                        <button type="button" class="btn btn-text btn-sm w-auto text-start"> <i class="fas fa-coins"></i> Invest</button>
                        <div></div>
                        <small class="card-text text-muted">Invest to this project and become a part of it</small>
                    </div>
                    <div class="mt-2">
                        <button type="button" class="btn btn-text btn-sm w-auto text-start"> <i class="fab fa-leanpub"></i> Learn More</button>
                        <div></div>
                        <small class="card-text text-muted">Learn more about investments and how they work in our project from the QA page</small>
                    </div>
                }
                else
                {
                    <h3 class="h3 text-primary safe-font" id="Preview_TagPrice">No Target Price</h3>
                    <small class="card-text text-muted" id="Preview_TagPriceDescription">this project isn't a startup</small>
                    <div class="mt-3" style="display: none;" id="InverToProject_Box">
                        <button type="button" class="btn btn-text btn-sm w-auto text-start"> <i class="fas fa-coins"></i> Invest</button>
                        <div></div>
                        <small class="card-text text-muted">Invest to this project and become a part of it</small>
                    </div>
                    <div class="mt-2">
                        <button type="button" class="btn btn-text btn-sm w-auto text-start"> <i class="fab fa-leanpub"></i> Learn More</button>
                        <div></div>
                        <small class="card-text text-muted">Learn more about investments and how they work in our project from the QA page</small>
                    </div>
                }
            </div>
            <div class="card shadow-sm p-3" id="Preview_LinksBox">
                <h6 class="h6">Main Links</h6>
                <div class="border-top mt-1 pt-1"></div>
                @if (ProjectInfo.Link1 != null)
                {
                    <div>
                        <a href="@ProjectInfo.Link1" class="btn btn-text btn-sm w-auto text-start" id="Preview_LinkBtn1"> <i class="fas fa-external-link-alt"></i> Click To Relocate</a>
                        <div></div>
                        <small class="card-text text-muted" id="Preview_LinkText1">@ProjectInfo.Link1</small>
                    </div>
                }
                else
                {
                    <div>
                        <a href="#" class="btn btn-text btn-sm w-auto text-start disabled" id="Preview_LinkBtn1"> <i class="fas fa-times-circle"></i> No Link</a>
                        <div></div>
                        <small class="card-text text-muted" id="Preview_LinkText1">No First Link</small>
                    </div>
                }
                @if (ProjectInfo.Link2 != null)
                {
                    <div class="mt-2">
                        <a href="@ProjectInfo.Link2" class="btn btn-text btn-sm mt-2 w-auto text-start" id="Preview_LinkBtn2"> <i class="fas fa-external-link-alt"></i> Click To Relocate</a>
                        <div></div>
                        <small class="card-text text-muted" id="Preview_LinkText2">@ProjectInfo.Link2</small>
                    </div>
                }
                else
                {
                    <div class="mt-2">
                        <a href="#" class="btn btn-text btn-sm mt-2 w-auto text-start disabled" id="Preview_LinkBtn2"> <i class="fas fa-times-circle"></i> No Link</a>
                        <div></div>
                        <small class="card-text text-muted" id="Preview_LinkText2">No Second Link Href</small>
                    </div>
                }
            </div>
        </div>
        @if (ProjectInfo.YoutubeLink != null)
        {
            <div class="box-container mt-2">
                <div class="card-group">
                    <div class="card me-2 p-2 shadow-sm">
                        <h6 class="h6"> <i class="fab fa-youtube text-danger"></i> Youtube Video</h6>
                        <div class="box-container mt-2" id="YT_VideoPlayer_Box">
                            <iframe class="yt-container w-100 ratio-16x9" id="YT_VideoPlayer" src="@ViewBag.YTLink" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                        </div>
                    </div>
                    <div class="card shadow-sm p-2">
                        <h6 class="h6"> <i class="fas fa-info-circle"></i> Additional Info</h6>
                        <small class="card-text text-muted mt-2" id="YT_VideoLink_Lbl"><i class="fas fa-external-link"></i> Link: @ViewBag.AdditionalYTLink</small>
                        <div class="mt-1"></div>
                        <a href="@ViewBag.AdditionalYTLink" class="btn btn-text btn-sm text-start text-decoration-none mt-1" id="YT_VideoLink_Btn"> <i class="fab fa-youtube text-danger"></i> Watch On Youtube</a>
                    </div>
                </div>
            </div>
        }
    </div>
</div>